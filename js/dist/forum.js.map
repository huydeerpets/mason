{"version":3,"sources":["webpack://@huydeerpets/mason/webpack/bootstrap","webpack://@huydeerpets/mason/./forum.js","webpack://@huydeerpets/mason/./node_modules/@babel/runtime/helpers/esm/inheritsLoose.js","webpack://@huydeerpets/mason/./src/forum/addComposerFields.js","webpack://@huydeerpets/mason/./src/forum/addFieldUpdateControl.js","webpack://@huydeerpets/mason/./src/forum/addFieldsOnDiscussionHero.js","webpack://@huydeerpets/mason/./src/forum/addFieldsOnDiscussionPost.js","webpack://@huydeerpets/mason/./src/forum/components/FieldEditDropdown.js","webpack://@huydeerpets/mason/./src/forum/components/FieldEditTags.js","webpack://@huydeerpets/mason/./src/forum/components/FieldEditText.js","webpack://@huydeerpets/mason/./src/forum/components/FieldGrid.js","webpack://@huydeerpets/mason/./src/forum/components/FieldsEditor.js","webpack://@huydeerpets/mason/./src/forum/components/FieldsEditorModal.js","webpack://@huydeerpets/mason/./src/forum/components/FieldsViewer.js","webpack://@huydeerpets/mason/./src/forum/helpers/chunkArray.js","webpack://@huydeerpets/mason/./src/forum/index.js","webpack://@huydeerpets/mason/./src/forum/patchModelIdentifier.js","webpack://@huydeerpets/mason/./src/lib/helpers/sortByAttribute.js","webpack://@huydeerpets/mason/./src/lib/models/Answer.js","webpack://@huydeerpets/mason/./src/lib/models/Field.js","webpack://@huydeerpets/mason/external \"flarum.core.compat['Component']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['Model']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['app']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['components/Button']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['components/CommentPost']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['components/DiscussionComposer']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['components/DiscussionHero']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['components/Modal']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['extend']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['helpers/icon']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['models/Discussion']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['tags/utils/sortTags']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['utils/DiscussionControls']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['utils/ItemList']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['utils/computed']\"","webpack://@huydeerpets/mason/external \"flarum.core.compat['utils/mixin']\""],"names":["DiscussionComposer","prototype","huydeerpetsMasonAnswers","extend","items","add","FieldsEditor","component","answers","onchange","ontagchange","tags","data","relationships","DiscussionControls","discussion","canUpdateHuydeerpetsMasonAnswers","Button","children","app","translator","trans","icon","onclick","modal","show","FieldsEditorModal","DiscussionHero","forum","attribute","FieldsViewer","props","showFieldsOnPost","post","number","CommentPost","subtree","check","map","answer","id","join","content","postHeaderIndex","findIndex","item","attrs","className","splice","FieldEditDropdown","init","field","view","selectedAnswerIdsForThisField","suggested_answers","forEach","answerIndex","a","push","m","multiple","event","target","options","option","selected","value","answerId","store","getById","length","disabled","required","hidden","placeholderHidden","selectPlaceholder","sortByAttribute","indexOf","text","name","Component","DiscussionFields","all","selectedTags","filter","tag","canAddToDiscussion","canStartDiscussion","minPrimary","maxPrimary","minSecondary","maxSecondary","isPrimary","sortTags","currentSelectedChild","sort","parent","fieldRequired","fieldLabel","withAttr","find","FieldEditText","answersForThisField","oninput","createRecord","attributes","Model","getIdentifier","placeholder","fieldPlaceholder","FieldGrid","chunkArray","row","fields","answerToFieldIndex","onsubmit","preventDefault","headItems","toArray","fieldItems","updateSelection","fieldAnswers","reverseFieldLookup","concat","ItemList","FieldEditTags","inputAttrs","input","user_values_allowed","description","dirty","processing","title","answersChanged","bind","loading","saveAnswers","save","then","close","redraw","catch","err","Modal","head","fieldsItems","answer_list","show_when_empty","itemsPerChunk","R","i","slice","initializers","models","Field","Answer","Discussion","hasMany","addComposerFields","addFieldsOnDiscussionHero","addFieldsOnDiscussionPost","addFieldUpdateControl","patchModelIdentifier","override","original","model","exists","type","attr","b","apiEndpoint","mixin","is_suggested","hasOne","min_answers_count","max_answers_count","validation","deleted_at","transformDate","all_answers","computed"],"mappings":"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","file":"forum.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = \"./forum.js\");\n","export * from './src/forum';\r\n","export default function _inheritsLoose(subClass, superClass) {\n  subClass.prototype = Object.create(superClass.prototype);\n  subClass.prototype.constructor = subClass;\n  subClass.__proto__ = superClass;\n}","import {extend} from 'flarum/extend';\r\nimport DiscussionComposer from 'flarum/components/DiscussionComposer';\r\nimport FieldsEditor from './components/FieldsEditor';\r\n\r\nexport default function () {\r\n    DiscussionComposer.prototype.huydeerpetsMasonAnswers = [];\r\n\r\n    extend(DiscussionComposer.prototype, 'headerItems', function (items) {\r\n        items.add('huydeerpets-mason-fields', FieldsEditor.component({\r\n            answers: this.huydeerpetsMasonAnswers,\r\n            onchange: answers => {\r\n                this.huydeerpetsMasonAnswers = answers;\r\n            },\r\n            ontagchange: tags => {\r\n                this.tags = tags;\r\n            },\r\n        }));\r\n    });\r\n\r\n    extend(DiscussionComposer.prototype, 'data', function (data) {\r\n        data.relationships = data.relationships || {};\r\n        data.relationships.huydeerpetsMasonAnswers = this.huydeerpetsMasonAnswers;\r\n    });\r\n}\r\n","import {extend} from 'flarum/extend';\r\nimport DiscussionControls from 'flarum/utils/DiscussionControls';\r\nimport Button from 'flarum/components/Button';\r\nimport FieldsEditorModal from './components/FieldsEditorModal';\r\n\r\nexport default function () {\r\n    extend(DiscussionControls, 'moderationControls', function (items, discussion) {\r\n        if (discussion.canUpdateHuydeerpetsMasonAnswers()) {\r\n            items.add('huydeerpets-mason-update-answers', Button.component({\r\n                children: app.translator.trans('huydeerpets-mason.forum.discussion-controls.edit-answers'),\r\n                icon: 'fas fa-tag',\r\n                onclick: () => app.modal.show(new FieldsEditorModal({discussion})),\r\n            }));\r\n        }\r\n    });\r\n}\r\n","import {extend} from 'flarum/extend';\r\nimport app from 'flarum/app';\r\nimport DiscussionHero from 'flarum/components/DiscussionHero';\r\nimport FieldsViewer from './components/FieldsViewer';\r\n\r\nexport default function () {\r\n    extend(DiscussionHero.prototype, 'items', function (items) {\r\n        if (!app.forum.attribute('huydeerpets.mason.fields-in-hero')) {\r\n            return;\r\n        }\r\n\r\n        items.add('huydeerpets-mason-fields', FieldsViewer.component({\r\n            discussion: this.props.discussion,\r\n        }));\r\n    });\r\n}\r\n","import {extend} from 'flarum/extend';\r\nimport app from 'flarum/app';\r\nimport CommentPost from 'flarum/components/CommentPost';\r\nimport FieldsViewer from './components/FieldsViewer';\r\n\r\nfunction showFieldsOnPost(post) {\r\n    // We only add fields to the first post, and only if fields are not displayed in the hero\r\n    // TODO: what if the first post is deleted ?\r\n    return post.number() === 1 && !app.forum.attribute('huydeerpets.mason.fields-in-hero');\r\n}\r\n\r\nexport default function () {\r\n    extend(CommentPost.prototype, 'init', function () {\r\n        this.subtree.check(\r\n            () => {\r\n                if (showFieldsOnPost(this.props.post)) {\r\n                    // Create a string with all answer ids\r\n                    // If answers change this string will be different\r\n                    return this.props.post.discussion().huydeerpetsMasonAnswers().map(answer => answer.id()).join(',');\r\n                }\r\n\r\n                // For other posts we always return the same thing\r\n                return '';\r\n            }\r\n        );\r\n    });\r\n\r\n    extend(CommentPost.prototype, 'content', function (content) {\r\n        if (!showFieldsOnPost(this.props.post)) {\r\n            return;\r\n        }\r\n\r\n        const postHeaderIndex = content.findIndex(item => item.attrs && item.attrs.className === 'Post-header');\r\n\r\n        // Insert the new content just after the header\r\n        // or at the very beginning if the header is not found\r\n        content.splice(postHeaderIndex === -1 ? 0 : postHeaderIndex + 1, 0, FieldsViewer.component({\r\n            discussion: this.props.post.discussion(),\r\n        }));\r\n    });\r\n}\r\n","import app from 'flarum/app';\r\nimport icon from 'flarum/helpers/icon';\r\nimport Component from 'flarum/Component';\r\nimport sortByAttribute from './../../lib/helpers/sortByAttribute';\r\n\r\nexport default class FieldEditDropdown extends Component {\r\n    init() {\r\n        this.field = this.props.field;\r\n        this.answers = this.props.answers;\r\n        this.onchange = this.props.onchange;\r\n    }\r\n\r\n    view() {\r\n        let selectedAnswerIdsForThisField = [];\r\n\r\n        this.field.suggested_answers().forEach(answer => {\r\n            const answerIndex = this.answers.findIndex(a => {\r\n                // Temporary store entries seem to turn into undefined after saving\r\n                if (typeof a === 'undefined') {\r\n                    return false;\r\n                }\r\n\r\n                return a.id() === answer.id();\r\n            });\r\n\r\n            if (answerIndex !== -1) {\r\n                selectedAnswerIdsForThisField.push(answer.id());\r\n            }\r\n        });\r\n\r\n        return m('span.Select', [\r\n            m('select.Select-input.FormControl', {\r\n                multiple: this.field.multiple(),\r\n                onchange: event => {\r\n                    let answers = [];\r\n\r\n                    for (let option of event.target.options) {\r\n                        if (option.selected && option.value !== 'none') {\r\n                            const answerId = option.value;\r\n\r\n                            // This will only work with suggested answers for now\r\n                            // As they are the only ones registered in the store\r\n                            answers.push(app.store.getById('huydeerpets-mason-answer', answerId));\r\n                        }\r\n                    }\r\n\r\n                    this.onchange(answers);\r\n                },\r\n            }, [\r\n                (this.field.multiple() ? null : m('option', {\r\n                    value: 'none',\r\n                    selected: selectedAnswerIdsForThisField.length === 0,\r\n                    disabled: this.field.required(),\r\n                    hidden: this.placeholderHidden(),\r\n                }, this.selectPlaceholder())),\r\n                sortByAttribute(this.field.suggested_answers()).map(\r\n                    answer => m('option', {\r\n                        value: answer.id(),\r\n                        selected: selectedAnswerIdsForThisField.indexOf(answer.id()) !== -1,\r\n                    }, answer.content())\r\n                ),\r\n            ]),\r\n            icon('fas fa-caret-down', {className: 'Select-caret'}),\r\n        ]);\r\n    }\r\n\r\n    placeholderHidden() {\r\n        // If labels are hidden, we need to always show the default value (even if it can't be selected)\r\n        // Otherwise when the field is \"required\" you can't find the name of the field anymore once something is selected\r\n        if (app.forum.attribute('huydeerpets.mason.labels-as-placeholders')) {\r\n            return false;\r\n        }\r\n\r\n        return this.field.required();\r\n    }\r\n\r\n    selectPlaceholder() {\r\n        let text = '';\r\n\r\n        if (app.forum.attribute('huydeerpets.mason.labels-as-placeholders')) {\r\n            text += this.field.name();\r\n\r\n            if (this.field.required()) {\r\n                text+= ' *';\r\n            }\r\n\r\n            text += ' - ';\r\n        }\r\n\r\n        if (this.field.required()) {\r\n            text += app.translator.trans('huydeerpets-mason.forum.answers.choose-option');\r\n        } else {\r\n            text += app.translator.trans('huydeerpets-mason.forum.answers.no-option-selected');\r\n        }\r\n\r\n        return text;\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\nimport icon from 'flarum/helpers/icon';\r\nimport Component from 'flarum/Component';\r\nimport sortTags from 'flarum/tags/utils/sortTags';\r\n\r\nexport default class DiscussionFields extends Component {\r\n    init() {\r\n        this.tags = app.store.all('tags');\r\n        this.selectedTags = [];\r\n\r\n        if (this.props.discussion) {\r\n            this.tags = this.tags.filter(tag => tag.canAddToDiscussion() || this.props.discussion.tags().indexOf(tag) !== -1);\r\n\r\n            this.selectedTags = this.props.discussion.tags();\r\n        } else {\r\n            this.tags = this.tags.filter(tag => tag.canStartDiscussion());\r\n        }\r\n\r\n        this.minPrimary = app.forum.attribute('minPrimaryTags');\r\n        this.maxPrimary = app.forum.attribute('maxPrimaryTags');\r\n        this.minSecondary = app.forum.attribute('minSecondaryTags');\r\n        this.maxSecondary = app.forum.attribute('maxSecondaryTags');\r\n\r\n        // If primary tags are disabled, don't offer them\r\n        if (this.maxPrimary <= 0) {\r\n            this.tags = this.tags.filter(tag => !tag.isPrimary());\r\n        }\r\n\r\n        // If secondary tags are disabled, don't offer them\r\n        if (this.maxSecondary <= 0) {\r\n            this.tags = this.tags.filter(tag => tag.isPrimary());\r\n        }\r\n\r\n        this.tags = sortTags(this.tags);\r\n    }\r\n\r\n    view() {\r\n        if (this.maxPrimary > 1 || this.maxSecondary > 1) {\r\n            return m('.Alert', app.translator.trans('huydeerpets-mason.forum.tags.inadequate-settings'));\r\n        }\r\n\r\n        // We take the first child selected or if none, the first parent selected\r\n        // Of course this only works if a single tag or tag+parent is selected\r\n        // Multiple tags are not supported on this selector\r\n        const currentSelectedChild = this.selectedTags.length ? this.selectedTags.sort(tag => tag.parent() ? -1 : 1)[0].id() : null;\r\n\r\n        const required = this.fieldRequired();\r\n\r\n        return m('.Mason-Field.Form-group', {\r\n            className: app.forum.attribute('huydeerpets.mason.labels-as-placeholders') ? 'Mason-Field--label-as-placeholder' : '',\r\n        }, [\r\n            m('label', this.fieldLabel()),\r\n            m('span.Select', [\r\n                m('select.Select-input.FormControl', {\r\n                    onchange: m.withAttr('value', id => {\r\n                        this.selectedTags = [];\r\n\r\n                        if (id !== 'none') {\r\n                            this.selectedTags.push(this.tags.find(tag => tag.id() === id));\r\n\r\n                            const parent = this.selectedTags[0].parent();\r\n                            if (parent) {\r\n                                this.selectedTags.push(parent);\r\n                            }\r\n                        }\r\n\r\n                        this.props.onchange(this.selectedTags);\r\n                    }),\r\n                }, [\r\n                    m('option', {\r\n                        value: 'none',\r\n                        selected: this.selectedTags.length === 0,\r\n                        disabled: required,\r\n                        hidden: this.placeholderHidden(),\r\n                    }, this.selectPlaceholder()),\r\n                    this.tags.map(\r\n                        tag => {\r\n                            const parent = tag.parent();\r\n\r\n                            return m('option', {\r\n                                value: tag.id(),\r\n                                selected: tag.id() === currentSelectedChild,\r\n                            }, (parent ? parent.name() + ' | ' : '') + tag.name());\r\n                        }\r\n                    ),\r\n                ]),\r\n                icon('fas fa-caret-down', {className: 'Select-caret'}),\r\n            ]),\r\n        ]);\r\n    }\r\n\r\n    fieldRequired() {\r\n        return this.minPrimary > 0 || this.minSecondary > 0;\r\n    }\r\n\r\n    fieldLabel() {\r\n        let text = app.forum.attribute('huydeerpets.mason.tags-field-name') || app.translator.trans('huydeerpets-mason.forum.tags.tags-label');\r\n\r\n        if (this.fieldRequired()) {\r\n            text += ' *';\r\n        }\r\n\r\n        return text;\r\n    }\r\n\r\n    placeholderHidden() {\r\n        if (app.forum.attribute('huydeerpets.mason.labels-as-placeholders')) {\r\n            return false;\r\n        }\r\n\r\n        return this.fieldRequired();\r\n    }\r\n\r\n    selectPlaceholder() {\r\n        let text = '';\r\n\r\n        if (app.forum.attribute('huydeerpets.mason.labels-as-placeholders')) {\r\n            text += this.fieldLabel() + ' - ';\r\n        }\r\n\r\n        if (this.fieldRequired()) {\r\n            text += app.translator.trans('huydeerpets-mason.forum.answers.choose-option');\r\n        } else {\r\n            text += app.translator.trans('huydeerpets-mason.forum.answers.no-option-selected');\r\n        }\r\n\r\n        return text;\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\nimport Model from 'flarum/Model';\r\nimport Component from 'flarum/Component';\r\n\r\nexport default class FieldEditText extends Component {\r\n    init() {\r\n        this.field = this.props.field;\r\n        this.answers = this.props.answers;\r\n        this.onchange = this.props.onchange;\r\n\r\n        this.content = '';\r\n\r\n        const answersForThisField = this.answers.filter(answer => {\r\n            // Temporary store entries seem to turn into undefined after saving\r\n            if (typeof answer === 'undefined') {\r\n                return false;\r\n            }\r\n\r\n            return answer.field().id() === this.field.id();\r\n        });\r\n\r\n        if (answersForThisField.length) {\r\n            // For now we only support a single custom answer\r\n            this.content = answersForThisField[0].content();\r\n        }\r\n    }\r\n\r\n    view() {\r\n        return m('input.FormControl', {\r\n            required: this.field.required(),\r\n            value: this.content,\r\n            oninput: m.withAttr('value', value => {\r\n                this.content = value;\r\n\r\n                if (this.content === '') {\r\n                    this.onchange([]);\r\n                } else {\r\n                    const answer = app.store.createRecord('huydeerpets-mason-answer', {\r\n                        attributes: {\r\n                            content: this.content,\r\n                        },\r\n                        relationships: {\r\n                            field: {\r\n                                data: Model.getIdentifier(this.field),\r\n                            },\r\n                        },\r\n                    });\r\n\r\n                    this.onchange([answer]);\r\n                }\r\n            }),\r\n            placeholder: this.fieldPlaceholder(),\r\n        });\r\n    }\r\n\r\n    fieldPlaceholder() {\r\n        if (app.forum.attribute('huydeerpets.mason.labels-as-placeholders')) {\r\n            return this.field.name() + (this.field.required() ? ' *' : '');\r\n        }\r\n\r\n        return '';\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\nimport Component from 'flarum/Component';\r\nimport chunkArray from './../helpers/chunkArray';\r\n\r\nexport default class FieldGrid extends Component {\r\n    view() {\r\n        return m('.Mason-Grid-Wrapper', m('.Mason-Grid', chunkArray(this.props.items, app.forum.attribute('huydeerpets.mason.column-count')).map(\r\n            row => m('.Mason-Row', row.map(\r\n                item => m('.Mason-Column', item)\r\n            ))\r\n        )));\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\nimport icon from 'flarum/helpers/icon';\r\nimport ItemList from 'flarum/utils/ItemList';\r\nimport Component from 'flarum/Component';\r\nimport sortByAttribute from './../../lib/helpers/sortByAttribute';\r\nimport FieldEditDropdown from './FieldEditDropdown';\r\nimport FieldEditText from './FieldEditText';\r\nimport FieldEditTags from './FieldEditTags';\r\nimport FieldGrid from './FieldGrid';\r\n\r\nexport default class FieldsEditor extends Component {\r\n    init() {\r\n        this.fields = sortByAttribute(app.store.all('huydeerpets-mason-field'));\r\n\r\n        // Index to quickly do a reverse lookup from answer to field\r\n        this.answerToFieldIndex = [];\r\n        this.fields.forEach(\r\n            field => {\r\n                field.suggested_answers().forEach(\r\n                    answer => {\r\n                        this.answerToFieldIndex[answer.id()] = field.id();\r\n                    }\r\n                );\r\n            }\r\n        );\r\n    }\r\n\r\n    view() {\r\n        return m('form.Mason-Fields.Mason-Fields--editor', {\r\n            onsubmit(event) {\r\n                event.preventDefault();\r\n            },\r\n        }, [\r\n            this.headItems().toArray(),\r\n            FieldGrid.component({\r\n                items: this.fieldItems().toArray(),\r\n            }),\r\n        ]);\r\n    }\r\n\r\n    updateSelection(field, fieldAnswers) {\r\n        // Keep only answers to other fields\r\n        let answers = this.props.answers.filter(\r\n            answer => {\r\n                const reverseFieldLookup = this.answerToFieldIndex[answer.id()];\r\n\r\n                // If the answer is not in the reverse lookup table it's probably a non-suggested (user) answer\r\n                // In that case the field should be linked in the relationship\r\n                if (typeof reverseFieldLookup === 'undefined') {\r\n                    return answer.field().id() !== field.id();\r\n                }\r\n\r\n                return reverseFieldLookup !== field.id();\r\n            }\r\n        );\r\n\r\n        answers = answers.concat(fieldAnswers);\r\n\r\n        this.props.onchange(answers);\r\n    }\r\n\r\n    headItems() {\r\n        const items = new ItemList();\r\n\r\n        if (app.forum.attribute('huydeerpets.mason.fields-section-title')) {\r\n            items.add('title', m('h5.Mason-Field--title', app.forum.attribute('huydeerpets.mason.fields-section-title')));\r\n        }\r\n\r\n        return items;\r\n    }\r\n\r\n    fieldItems() {\r\n        const items = new ItemList();\r\n\r\n        if (app.forum.attribute('huydeerpets.mason.tags-as-fields')) {\r\n            items.add('tags', FieldEditTags.component({\r\n                discussion: this.props.discussion,\r\n                onchange: tags => {\r\n                    if (this.props.ontagchange) {\r\n                        this.props.ontagchange(tags);\r\n                    }\r\n                },\r\n            }));\r\n        }\r\n\r\n        this.fields.forEach(field => {\r\n            const inputAttrs = {\r\n                field,\r\n                answers: this.props.answers,\r\n                onchange: fieldAnswers => {\r\n                    // Every input component calls \"onchange\" with a list of answers from the store\r\n                    this.updateSelection(field, fieldAnswers);\r\n                },\r\n            };\r\n            let input = null;\r\n\r\n            if (field.user_values_allowed()) {\r\n                input = FieldEditText.component(inputAttrs);\r\n            } else {\r\n                input = FieldEditDropdown.component(inputAttrs);\r\n            }\r\n\r\n            items.add('field-' + field.id(), m('.Mason-Field.Form-group', {\r\n                className: app.forum.attribute('huydeerpets.mason.labels-as-placeholders') ? 'Mason-Field--label-as-placeholder' : '',\r\n            }, [\r\n                m('label', [\r\n                    (field.icon() ? [icon(field.icon()), ' '] : null),\r\n                    field.name(),\r\n                    (field.required() ? ' *' : null),\r\n                ]),\r\n                input,\r\n                (field.description() ? m('.helpText', field.description()) : null),\r\n            ]));\r\n        });\r\n\r\n        return items;\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\nimport Modal from 'flarum/components/Modal';\r\nimport Button from 'flarum/components/Button';\r\nimport FieldsEditor from './FieldsEditor';\r\n\r\nexport default class FieldsEditorModal extends Modal {\r\n    init() {\r\n        super.init();\r\n\r\n        this.answers = this.props.discussion.huydeerpetsMasonAnswers();\r\n        this.dirty = false;\r\n        this.processing = false;\r\n\r\n        // Stays null if the feature is not used\r\n        this.tags = null;\r\n    }\r\n\r\n    title() {\r\n        return app.translator.trans('huydeerpets-mason.forum.answers-modal.edit-title', {\r\n            title: m('em', this.props.discussion.title()),\r\n        });\r\n    }\r\n\r\n    content() {\r\n        return [\r\n            m('.Modal-body', FieldsEditor.component({\r\n                discussion: this.props.discussion, // Only for the tags feature\r\n                answers: this.answers,\r\n                onchange: this.answersChanged.bind(this),\r\n                ontagchange: tags => {\r\n                    this.tags = tags;\r\n                    this.dirty = true;\r\n                },\r\n            })),\r\n            m('.Modal-footer', [\r\n                Button.component({\r\n                    className: 'Button Button--primary',\r\n                    children: app.translator.trans('huydeerpets-mason.forum.answers-modal.save'),\r\n                    loading: this.processing,\r\n                    disabled: !this.dirty,\r\n                    onclick: this.saveAnswers.bind(this),\r\n                }),\r\n            ]),\r\n        ];\r\n    }\r\n\r\n    answersChanged(answers) {\r\n        this.answers = answers;\r\n        this.dirty = true;\r\n    }\r\n\r\n    saveAnswers() {\r\n        this.processing = true;\r\n\r\n        let relationships = {\r\n            huydeerpetsMasonAnswers: this.answers,\r\n        };\r\n\r\n        // If tag edit is enabled, take care of them here as well\r\n        if (this.tags !== null) {\r\n            relationships.tags = this.tags;\r\n        }\r\n\r\n        this.props.discussion.save({\r\n            relationships,\r\n        }).then(() => {\r\n            this.processing = false;\r\n            app.modal.close();\r\n            m.redraw();\r\n        }).catch(err => {\r\n            this.processing = false;\r\n            throw err;\r\n        });\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\nimport icon from 'flarum/helpers/icon';\r\nimport ItemList from 'flarum/utils/ItemList';\r\nimport Component from 'flarum/Component';\r\nimport Button from 'flarum/components/Button';\r\nimport FieldsEditorModal from './FieldsEditorModal';\r\nimport FieldGrid from './FieldGrid';\r\nimport sortByAttribute from './../../lib/helpers/sortByAttribute';\r\n\r\nexport default class FieldsViewer extends Component {\r\n    init() {\r\n        this.fields = sortByAttribute(app.store.all('huydeerpets-mason-field'));\r\n        this.discussion = this.props.discussion;\r\n    }\r\n\r\n    view() {\r\n        const head = this.headItems().toArray();\r\n        const fields = this.fieldsItems().toArray();\r\n\r\n        // If all fields are hidden\r\n        // And either no controls are shown or the setting hides them\r\n        // We don't show the viewer\r\n        if (!fields.length && (!head.length || app.forum.attribute('huydeerpets.mason.hide-empty-fields-section'))) {\r\n            // We need to return an actual dom element or Flarum does not like it\r\n            return m('div');\r\n        }\r\n\r\n        return m('.Mason-Fields.Mason-Fields--viewer', [\r\n            head,\r\n            FieldGrid.component({\r\n                items: fields,\r\n            }),\r\n        ]);\r\n    }\r\n\r\n    headItems() {\r\n        const items = new ItemList();\r\n\r\n        if (this.discussion.canUpdateHuydeerpetsMasonAnswers()) {\r\n            items.add('edit', Button.component({\r\n                className: 'Button Mason-Fields--edit',\r\n                children: app.translator.trans('huydeerpets-mason.forum.discussion-controls.edit-answers'),\r\n                icon: 'fas fa-pen',\r\n                onclick: () => app.modal.show(new FieldsEditorModal({\r\n                    discussion: this.discussion,\r\n                })),\r\n            }));\r\n        }\r\n\r\n        if (app.forum.attribute('huydeerpets.mason.fields-section-title')) {\r\n            items.add('title', m('h5.Mason-Field--title', app.forum.attribute('huydeerpets.mason.fields-section-title')));\r\n        }\r\n\r\n        return items;\r\n    }\r\n\r\n    fieldsItems() {\r\n        const items = new ItemList();\r\n\r\n        this.fields.forEach(field => {\r\n            // Discussion answers to this field\r\n            const answers = sortByAttribute(this.discussion.huydeerpetsMasonAnswers().filter(answer => {\r\n                // It's necessary to compare the field() relationship\r\n                // Because field.suggested_answers() won't contain new and user answers\r\n                return answer.field().id() === field.id();\r\n            }));\r\n\r\n            let answer_list = answers.map(answer => m('span.Mason-Inline-Answer', answer.content()));\r\n\r\n            if (answers.length === 0) {\r\n                if (field.show_when_empty()) {\r\n                    answer_list.push(m('em.Mason-Inline-Answer', app.translator.trans('huydeerpets-mason.forum.post-answers.no-answer')));\r\n                } else {\r\n                    // If the field has no answer and the setting is off we don't show it\r\n                    return;\r\n                }\r\n            }\r\n\r\n            items.add('field-' + field.id(), m('.Mason-Field.Form-group', [\r\n                m('label', [\r\n                    (field.icon() ? [icon(field.icon()), ' '] : null),\r\n                    field.name(),\r\n                ]),\r\n                m('.FormControl.Mason-Inline-Answers', answer_list),\r\n            ]));\r\n        });\r\n\r\n        return items;\r\n    }\r\n}\r\n","/**\r\n * Split an array into multiple arrays of a given size\r\n * Useful for grid layouts\r\n * @see https://stackoverflow.com/a/10456644/3133038\r\n * @param {Array} items\r\n * @param {number} itemsPerChunk\r\n * @returns {Array}\r\n */\r\nexport default function (items, itemsPerChunk) {\r\n    let R = [];\r\n    for (let i = 0; i < items.length; i += itemsPerChunk) {\r\n        R.push(items.slice(i, i + itemsPerChunk));\r\n    }\r\n    return R;\r\n}\r\n","import app from 'flarum/app';\r\nimport Model from 'flarum/Model';\r\nimport Discussion from 'flarum/models/Discussion';\r\nimport Answer from './../lib/models/Answer';\r\nimport Field from './../lib/models/Field';\r\nimport addComposerFields from './addComposerFields';\r\nimport addFieldUpdateControl from './addFieldUpdateControl';\r\nimport addFieldsOnDiscussionHero from './addFieldsOnDiscussionHero';\r\nimport addFieldsOnDiscussionPost from './addFieldsOnDiscussionPost';\r\nimport patchModelIdentifier from \"./patchModelIdentifier\";\r\n\r\napp.initializers.add('huydeerpets-mason', app => {\r\n    app.store.models['huydeerpets-mason-field'] = Field;\r\n    app.store.models['huydeerpets-mason-answer'] = Answer;\r\n\r\n    Discussion.prototype.huydeerpetsMasonAnswers = Model.hasMany('huydeerpetsMasonAnswers');\r\n    Discussion.prototype.canUpdateHuydeerpetsMasonAnswers = Model.attribute('canUpdateHuydeerpetsMasonAnswers');\r\n\r\n    addComposerFields();\r\n    addFieldsOnDiscussionHero();\r\n    addFieldsOnDiscussionPost();\r\n    addFieldUpdateControl();\r\n    patchModelIdentifier();\r\n});\r\n","import {override} from 'flarum/extend';\r\nimport Model from 'flarum/Model';\r\nimport Answer from './../lib/models/Answer';\r\n\r\nexport default function () {\r\n    override(Model, 'getIdentifier', function (original, model) {\r\n        // For Answers that don't yet exist, we include the content and the field relationship when calling the API\r\n        // That way they can be created server-side without making individual API requests for each answer\r\n        if (model instanceof Answer && !model.exists) {\r\n            return {\r\n                type: model.data.type,\r\n                attributes: {\r\n                    content: model.data.attributes.content,\r\n                },\r\n                relationships: {\r\n                    field: {\r\n                        data: Model.getIdentifier(model.data.relationships.field),\r\n                    },\r\n                },\r\n            };\r\n        }\r\n\r\n        // Default behaviour\r\n        return original(model);\r\n    })\r\n}\r\n","export default function (items, attr = 'sort') {\r\n    return items.sort(\r\n        (a, b) => a[attr]() - b[attr]()\r\n    );\r\n}\r\n","import app from 'flarum/app';\r\nimport Model from 'flarum/Model';\r\nimport mixin from 'flarum/utils/mixin';\r\n\r\nexport default class Answer extends mixin(Model, {\r\n    content: Model.attribute('content'),\r\n    is_suggested: Model.attribute('is_suggested'),\r\n    sort: Model.attribute('sort'),\r\n    field: Model.hasOne('field'),\r\n}) {\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    apiEndpoint() {\r\n        return '/huydeerpets/mason/answers' + (this.exists ? '/' + this.data.id : '');\r\n    }\r\n}\r\n","import app from 'flarum/app';\r\nimport Model from 'flarum/Model';\r\nimport mixin from 'flarum/utils/mixin';\r\nimport computed from 'flarum/utils/computed';\r\n\r\nexport default class Field extends mixin(Model, {\r\n    name: Model.attribute('name'),\r\n    description: Model.attribute('description'),\r\n    min_answers_count: Model.attribute('min_answers_count'),\r\n    max_answers_count: Model.attribute('max_answers_count'),\r\n    show_when_empty: Model.attribute('show_when_empty'),\r\n    user_values_allowed: Model.attribute('user_values_allowed'),\r\n    validation: Model.attribute('validation'),\r\n    icon: Model.attribute('icon'),\r\n    sort: Model.attribute('sort'),\r\n    deleted_at: Model.attribute('deleted_at', Model.transformDate),\r\n    all_answers: Model.hasMany('all_answers'),\r\n    suggested_answers: Model.hasMany('suggested_answers'),\r\n    required: computed('min_answers_count', min_answers_count => min_answers_count > 0),\r\n    multiple: computed('max_answers_count', max_answers_count => max_answers_count > 1),\r\n}) {\r\n    /**\r\n     * @inheritDoc\r\n     */\r\n    apiEndpoint() {\r\n        return '/huydeerpets/mason/fields' + (this.exists ? '/' + this.data.id : '');\r\n    }\r\n}\r\n","module.exports = flarum.core.compat['Component'];","module.exports = flarum.core.compat['Model'];","module.exports = flarum.core.compat['app'];","module.exports = flarum.core.compat['components/Button'];","module.exports = flarum.core.compat['components/CommentPost'];","module.exports = flarum.core.compat['components/DiscussionComposer'];","module.exports = flarum.core.compat['components/DiscussionHero'];","module.exports = flarum.core.compat['components/Modal'];","module.exports = flarum.core.compat['extend'];","module.exports = flarum.core.compat['helpers/icon'];","module.exports = flarum.core.compat['models/Discussion'];","module.exports = flarum.core.compat['tags/utils/sortTags'];","module.exports = flarum.core.compat['utils/DiscussionControls'];","module.exports = flarum.core.compat['utils/ItemList'];","module.exports = flarum.core.compat['utils/computed'];","module.exports = flarum.core.compat['utils/mixin'];"],"sourceRoot":""}